<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wangzhixuan.mapper.RedPacketLogMapper">

	<!-- 通用查询映射结果 -->
	<resultMap id="RedPacketLog" type="com.wangzhixuan.model.RedPacketLog">
		<result column="id" property="id" />
		<result column="start_no" property="startNo" />
		<result column="round_number" property="roundNumber" />
		<result column="red_packet_no" property="redPacketNo" />
		<result column="lottery_number" property="lotteryNumber" />
		<result column="minimum_amount" property="minimumAmount" />
		<result column="crowdfunding_amount" property="crowdfundingAmount" />
		<result column="type" property="type" />
		<result column="amount" property="amount" />
		<result column="wish" property="wish" />
		<result column="create_time" property="createTime" />
	</resultMap>
	
	<!-- 用于select查询公用抽取的列 -->
	<sql id="Base_Column_List">
	    <![CDATA[
        id, start_no, round_number, red_packet_no, lottery_number, minimum_amount, 
        crowdfunding_amount, type, amount, wish , create_time 
	    ]]>
	</sql>
	
	<select id="selectRedPacketLogVoPage"  resultType="RedPacketLogVo">
		SELECT 
			r.id AS id,
			p.nick AS nick,
			r.start_no AS startNo,
			r.round_number AS roundNumber,
			r.red_packet_no AS redPacketNo,
			r.lottery_number AS lotteryNumber,
			r.minimum_amount AS minimumAmount,
			r.crowdfunding_amount AS crowdfundingAmount,
			r.type AS type,
			r.amount AS amount,
			r.wish AS wish,
			r.create_time AS createTime					
		FROM red_packet_log r 
		LEFT JOIN player p ON r.start_no = p.start_no 
			<where>
	        	1=1
	            <if test=" startNo != null and startNo != '' ">
	               and r.start_no like concat(concat('%',#{startNo}),'%') 
	            </if>
	        </where>
		GROUP BY r.id
    </select>
	
	<select id="getRedByRound" resultMap="RedPacketLog">
		SELECT <include refid="Base_Column_List"/>
		 FROM red_packet_log 
		<where>
			1=1
		 	<if test=" startNo != null ">
		 		and start_no = #{startNo}
		 	</if>
		 	<if test=" round != null ">
		 		and round_number = #{round}
		 	</if>
		</where>
		limit 1
    </select>
	
	<select id="getAlreadyRed" resultMap="RedPacketLog">
		SELECT <include refid="Base_Column_List"/>
		 FROM red_packet_log 
		<where>
			1=1
		 	<if test=" startNo != null ">
		 		and start_no = #{startNo}
		 	</if>
		 	<if test=" redPacketNo != null ">
		 		and red_packet_no = #{redPacketNo}
		 	</if>
		 	<if test=" round != null ">
		 		and round_number = #{round}
		 	</if>
		</where>
		limit 1
    </select>

</mapper>
