<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wangzhixuan.mapper.PlayRoomMapper">

	<!-- 通用查询映射结果 -->
	<resultMap id="PlayRoom" type="com.wangzhixuan.model.PlayRoom">
		<result column="id" property="id" />
		<result column="play_id" property="playId" />
		<result column="play_nick" property="playNick" />
		<result column="room_id" property="roomId" />
		<result column="house_owner" property="houseOwner" />
		<result column="owner_name" property="ownerName" />
		<result column="join_time" property="joinTime" />
		<result column="room_create_time" property="roomCreateTime" />
		<result column="room_disappaear_time" property="roomDisappaearTime" />
		<result column="room_party_num" property="roomPartyNum" />
		<result column="join_party_num" property="joinPartyNum" />
		<result column="jetton_num" property="jettonNum" />
		<result column="financial_water" property="financialWater" />
		<result column="player_financial_water" property="playerFinancialWater" />
		<result column="insurance_water" property="insuranceWater" />
		<result column="player_insurance_water" property="playerInsuranceWater" />
		<result column="profit_num" property="profitNum" />
		<result column="insurance_profit_num" property="insuranceProfitNum" />
	</resultMap>
	
	<sql id="Base_Column_List">
	    <![CDATA[
        id, play_id, play_nick, room_id, house_owner, owner_name, join_time, room_create_time, 
        room_disappaear_time, room_party_num, join_party_num, jetton_num, 
        financial_water, player_financial_water, insurance_water, player_insurance_water,
        profit_num, insurance_profit_num 
	    ]]>
	</sql>
	
	<select id="getPlayRoomBy" resultMap="PlayRoom">
       SELECT <include refid="Base_Column_List"/> 
        FROM play_room 
        <where>
        	1=1
        	<if test=" playerId != null and playerId != '' ">
               and play_id = #{playerId} 
            </if>
            <if test=" houseOwner != null and houseOwner != '' ">
               and house_owner = #{houseOwner} 
            </if>
            <if test=" roomId != null and roomId != '' ">
               and room_id = #{roomId} 
            </if>
            <if test=" joinTime != null ">
               <![CDATA[ and  DATEDIFF(join_time,#{joinTime}) <= #{roomDays } ]]> 
               <![CDATA[ and  DATEDIFF(join_time,#{joinTime}) >= -#{roomDays } ]]> 
            </if>
        </where>
        GROUP BY id 
        limit 1
    </select>
    
    <select id="selectPlayRoomPage" resultMap="PlayRoom">
        SELECT <include refid="Base_Column_List"/> 
	        FROM play_room 
	        <where>
	        	1=1
	            <if test=" playId != null and playId != '' ">
	               and play_id like concat(concat('%',#{playId}),'%') 
	            </if>
	            <if test=" roomId != null ">
	               and room_id like concat(concat('%',#{roomId}),'%') 
	            </if>
	            
	        </where>
	        GROUP BY id 
    </select>
    
    	
	<update id="updateRoomPartyNum">
  		update play_room set room_party_num = #{partyNum} 
  		where room_id = #{roomId} and house_owner=#{houseOwner } 
  		 <![CDATA[ and  DATEDIFF(room_create_time,#{createTime}) <= #{roomDays } ]]>
	     <![CDATA[ and  DATEDIFF(room_create_time,#{createTime}) >= -#{roomDays } ]]> 
  	</update>
  	
  	<update id="updateRoomFinancialWater">
  		update play_room set financial_water = #{financialWater} 
  		where room_id = #{roomId} and house_owner=#{houseOwner } 
  		 <![CDATA[ and  DATEDIFF(room_create_time,#{createTime}) <= #{roomDays } ]]>
	     <![CDATA[ and  DATEDIFF(room_create_time,#{createTime}) >= -#{roomDays } ]]> 
  	</update>
  	
	<update id="updateRoomInsuranceWater">
  		update play_room set insurance_water = #{insuranceWater} 
  		where room_id = #{roomId} and house_owner=#{houseOwner } 
  		 <![CDATA[ and  DATEDIFF(room_create_time,#{createTime}) <= #{roomDays } ]]>
	     <![CDATA[ and  DATEDIFF(room_create_time,#{createTime}) >= -#{roomDays } ]]> 
  	</update>
  	
  	<update id="updateRoomDisappaearTime">
  		update play_room set room_disappaear_time = #{disappaearTime} 
  		where room_id = #{roomId} and house_owner=#{houseOwner } 
  		 <![CDATA[ and  DATEDIFF(room_create_time,#{createTime}) <= #{roomDays } ]]>
	     <![CDATA[ and  DATEDIFF(room_create_time,#{createTime}) >= -#{roomDays } ]]> 
  	</update>
  	

</mapper>
