<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wangzhixuan.mapper.BetLogMapper">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.wangzhixuan.model.BetLog">
		<result column="id" property="id" />
		<result column="player_id" property="playerId" />
		<result column="room_id" property="roomId" />
		<result column="house_owner" property="houseOwner" />
		<result column="party_no" property="partyNo" />
		<result column="bet_num" property="betNum" />
		<result column="bet_time" property="betTime" />
	</resultMap>
	
	<select id="getFinancialWater" resultType="Map">
		SELECT IFNULL(sum(bet_num),0) financialWater, room_id, house_owner 
		FROM bet_log 
	        <where>
	        	1=1
	        	<if test=" playId != null and playId != '' ">
	              and player_id = #{playId} 
	            </if>
	            <if test=" houseOwner != null and houseOwner != '' ">
	              and house_owner = #{houseOwner} 
	            </if>
	            <if test=" roomId != null and roomId != '' ">
	              and room_id = #{roomId} 
	            </if>
	            <if test=" createTime != null ">
	               <![CDATA[ and  DATEDIFF(bet_time,#{createTime}) <= #{roomDays } ]]>
	               <![CDATA[ and  DATEDIFF(bet_time,#{createTime}) >= -#{roomDays } ]]>
	            </if>
	        </where>
	        GROUP BY room_id,house_owner 
	</select>
	
	<select id="selectBetData" resultType="Map">
		SELECT 
			IFNULL(SUM(if(id>0,jetton_num,0)),0) allBets,
			IFNULL(SUM(IF(TO_DAYS(jetton_time)=TO_DAYS(NOW()),jetton_num,0)),0) todayBets
			FROM jetton_log
	</select>

</mapper>
