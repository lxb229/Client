<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wangzhixuan.mapper.RoomMapper">

	<!-- 通用查询映射结果 -->
	<resultMap id="Room" type="com.wangzhixuan.model.Room">
		<result column="id" property="id" />
		<result column="room_id" property="roomId" />
		<result column="room_name" property="roomName" />
		<result column="house_owner" property="houseOwner" />
		<result column="owner_name" property="ownerName" />
		<result column="create_time" property="createTime" />
		<result column="disappear_time" property="disappearTime" />
		<result column="time_set" property="timeSet" />
		<result column="size_blind" property="sizeBlind" />
		<result column="jetton_set" property="jettonSet" />
		<result column="insurance" property="insurance" />
		<result column="straddle" property="straddle" />
		<result column="party_num" property="partyNum" />
		<result column="join_room_num" property="joinRoomNum" />
		<result column="join_party_num" property="joinPartyNum" />
		<result column="jetton_num" property="jettonNum" />
		<result column="financial_water" property="financialWater" />
		<result column="insurance_water" property="insuranceWater" />
	</resultMap>
	
	<!-- 用于select查询公用抽取的列 -->
	<sql id="Base_Column_List">
	    <![CDATA[
        id, room_id, room_name, house_owner, owner_name, create_time, disappear_time, 
        time_set, size_blind, jetton_set, insurance, straddle, join_room_num, 
        party_num, join_party_num, jetton_num, financial_water, insurance_water 
	    ]]>
	</sql>
	
	<select id="selectRoomPage" resultMap="Room">
       SELECT <include refid="Base_Column_List"/> 
        FROM room 
        <where>
        	1=1
            <if test=" houseOwner != null and houseOwner != '' ">
               and house_owner like concat(concat('%',#{houseOwner}),'%') 
            </if>
            <if test=" roomId != null and roomId != '' ">
               and room_id like concat(concat('%',#{roomId}),'%') 
            </if>
        </where>
        GROUP BY id 
    </select>
    
    <select id="getRoomBy" resultMap="Room">
       SELECT <include refid="Base_Column_List"/> 
        FROM room 
        <where>
        	1=1
            <if test=" houseOwner != null and houseOwner != '' ">
              and house_owner = #{houseOwner} 
            </if>
            <if test=" roomId != null and roomId != '' ">
              and room_id = #{roomId} 
            </if>
            <if test=" createTime != null ">
               <![CDATA[ and  DATEDIFF(create_time,#{createTime}) <= #{roomDays } ]]> 
               <![CDATA[ and  DATEDIFF(create_time,#{createTime}) >= -#{roomDays } ]]> 
            </if>
        </where>
        GROUP BY id 
        limit 1
    </select>
    
    <select id="selectRoomData" resultType="Map">
		SELECT 
			IFNULL(SUM(if(id>0,1,0)),0) allRooms,
			IFNULL(SUM(IF(TO_DAYS(create_time)=TO_DAYS(NOW()),1,0)),0) todayRooms
			FROM room
	</select>
	
	<select id="selectAllPartys" resultType="Map">
		SELECT IFNULL(SUM(party_num),0) allPartys  FROM room
	</select>

</mapper>
