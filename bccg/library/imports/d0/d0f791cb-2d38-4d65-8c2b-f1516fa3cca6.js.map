{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Modules/assets\\Script\\Modules\\NativeCallJS.ts"],"names":[],"mappings":";;;;;AAAA,iCAAmC;AAEnC;;;;;GAKG;AACH,wBAAqC,IAAY;;;;;;;oBAErC,GAAG,GAAG,0DAA0D,GAAG,MAAM,CAAC,MAAM,GAAG,UAAU,GAAG,MAAM,CAAC,MAAM,GAAG,QAAQ,GAAG,IAAI,GAAG,gCAAgC,CAAC;oBACxJ,qBAAM,KAAK,CAAC,GAAG,CAAC,EAAA;;oBAA3B,QAAQ,GAAG,SAAgB;yBAC3B,QAAQ,CAAC,EAAE,EAAX,wBAAW;oBACW,qBAAM,QAAQ,CAAC,IAAI,EAAE,EAAA;;oBAAvC,IAAI,GAAc,SAAqB;yBACvC,IAAI,CAAC,YAAY,EAAjB,wBAAiB;oBACb,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC;oBAC7B,EAAE,CAAC,OAAO,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;oBAC1C,YAAY,GAAG,sDAAsD,GAAG,IAAI,CAAC,YAAY,GAAG,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC;oBACjG,qBAAM,KAAK,CAAC,YAAY,CAAC,EAAA;;oBAA7C,iBAAiB,GAAG,SAAyB;yBAC7C,iBAAiB,CAAC,EAAE,EAApB,wBAAoB;oBACL,qBAAM,iBAAiB,CAAC,IAAI,EAAE,EAAA;;oBAAzC,QAAQ,GAAG,SAA8B;oBAC7C,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC,CAAC;;;oBAE7D,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC,CAAC;;;;oBAGnE,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC,CAAC;;;;oBAGpE,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC,CAAC;;;;;oBAGpE,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC,CAAC;;;;;;CAEtE;AA1BD,wCA0BC;AAED;;;;GAIG;AACH;IACI,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;AAC/D,CAAC;AAFD,gCAEC;AAED;;;;;GAKG;AACH,uBAA8B,MAAc;IACxC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;AAC5C,CAAC;AAFD,sCAEC","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Modules","sourcesContent":["import * as Config from './Config';\r\n\r\n/**\r\n * 微信登录-获取access_token\r\n * \r\n * @export\r\n * @param {string} code 登录授权获取到的code\r\n */\r\nexport async function getAccessToken(code: string) {\r\n    try {\r\n        let url = 'https://api.weixin.qq.com/sns/oauth2/access_token?appid=' + Config.app_id + '&secret=' + Config.secret + '&code=' + code + '&grant_type=authorization_code';\r\n        let response = await fetch(url);\r\n        if (response.ok) {\r\n            let data: TokenInfo = await response.json();\r\n            if (data.access_token) {\r\n                let db = cc.sys.localStorage;\r\n                db.setItem('TokenInfo', JSON.stringify(data));\r\n                let url_userInfo = 'https://api.weixin.qq.com/sns/userinfo?access_token=' + data.access_token + '&openid=' + data.openid;\r\n                let response_userInfo = await fetch(url_userInfo);\r\n                if (response_userInfo.ok) {\r\n                    let userInfo = await response_userInfo.json();\r\n                    cc.systemEvent.emit('cb_login', { flag: 1, data: userInfo });\r\n                } else {\r\n                    cc.systemEvent.emit('cb_login', { flag: 0, data: '获取用户信息失败' });\r\n                }\r\n            } else {\r\n                cc.systemEvent.emit('cb_login', { flag: 0, data: '获取token失败' });\r\n            }\r\n        } else {\r\n            cc.systemEvent.emit('cb_login', { flag: 0, data: '请求token失败' });\r\n        }\r\n    } catch (err) {\r\n        cc.systemEvent.emit('cb_login', { flag: 0, data: 'http请求异常' });\r\n    }\r\n}\r\n\r\n/**\r\n * 微信登录-授权失败\r\n * \r\n * @export\r\n */\r\nexport function loginError(): void {\r\n    cc.systemEvent.emit('cb_login', { flag: 0, data: '授权失败' });\r\n}\r\n\r\n/**\r\n * 微信分享-结果回调\r\n * \r\n * @export\r\n * @param {number} result 分享结果,0为成功\r\n */\r\nexport function shareCallback(result: number): void {\r\n    cc.systemEvent.emit('cb_share', result);\r\n}"]}