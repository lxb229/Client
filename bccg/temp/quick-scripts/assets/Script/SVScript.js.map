{"version":3,"sources":["SVScript.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class SVScript extends cc.Component {\r\n    /**\r\n     * item的预制,需要绑定item脚本,且和prefab同名\r\n     * \r\n     * @type {cc.Prefab}\r\n     * @memberof SVScript\r\n     */\r\n    @property(cc.Prefab)\r\n    itemPrefab: cc.Prefab = null;\r\n    /**\r\n     * 两个item之间的间隔\r\n     * \r\n     * @type {number}\r\n     * @memberof SVScript\r\n     */\r\n    @property(cc.Integer)\r\n    spacing: number = 0;\r\n    /**\r\n     * 刷新间隔\r\n     * \r\n     * @type {number}\r\n     * @memberof SVScript\r\n     */\r\n    @property(cc.Integer)\r\n    updateInterval: number = 0.2;\r\n    /**\r\n     * 存放item的数组\r\n     * \r\n     * @type {cc.Node[]}\r\n     * @memberof SVScript\r\n     */\r\n    itemNodes: cc.Node[] = [];\r\n    /**\r\n     * 用于创建item的数据集合\r\n     * \r\n     * @type {any[]}\r\n     * @memberof SVScript\r\n     */\r\n    datas: any[] = null;\r\n    /**\r\n     * item的尺寸\r\n     * \r\n     * @type {cc.Size}\r\n     * @memberof SVScript\r\n     */\r\n    itemSize: cc.Size = cc.size(0, 0);\r\n    /**\r\n     * item的回调函数\r\n     * \r\n     * @type {Function}\r\n     * @memberof SVScript\r\n     */\r\n    callback: Function = null;\r\n    /**\r\n     * 计时器时间\r\n     * \r\n     * @type {number}\r\n     * @memberof SVScript\r\n     */\r\n    updateTimer: number = 0;\r\n    /**\r\n     * 上一次content坐标\r\n     * \r\n     * @type {number}\r\n     * @memberof SVScript\r\n     */\r\n    lastContentPosY: number = 0;\r\n    /**\r\n     * scrollview组件\r\n     * \r\n     * @type {cc.ScrollView}\r\n     * @memberof SVScript\r\n     */\r\n    sv: cc.ScrollView = null;\r\n    /**\r\n     * 实例化滚动控件\r\n     * \r\n     * @param {any[]} dataList 数据集合\r\n\r\n     * @param {Function} cb 回调函数，可用于点击item回调，item通知sv数据变化等\r\n     * @memberof SVScript\r\n     */\r\n    init(dataList: any[], cb?: Function) {\r\n        if (!dataList || dataList.length < 1) return;\r\n        if (!this.itemPrefab) return;\r\n        this.sv = this.node.getComponent(cc.ScrollView);\r\n        this.itemNodes.length = 0;\r\n        if (this.updateInterval < 0) this.updateInterval = 0.2;\r\n        this.datas = dataList;\r\n        this.callback = cb;\r\n        let tempItem = cc.instantiate(this.itemPrefab);\r\n        this.itemSize = tempItem.getContentSize();\r\n        tempItem.destroy();\r\n        this.sv.content.height = this.datas.length * (this.itemSize.height + this.spacing);\r\n        let count = Math.ceil(this.node.height / (this.itemSize.height + this.spacing)) * 2;\r\n        for (let i = 0; i < count; i++) {\r\n            if (i < this.datas.length) {\r\n                let itemNode = cc.instantiate(this.itemPrefab);\r\n                itemNode.tag = i;\r\n                itemNode.setPosition(0, -itemNode.height * (0.5 + i) - this.spacing * (i + 1));\r\n                itemNode.getComponent(this.itemPrefab.name).updateItem(this.datas[i], this.callback);\r\n                this.sv.content.addChild(itemNode);\r\n                this.itemNodes.push(itemNode);\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    //获取item以滚动控件为坐标系的坐标\r\n    getPositionInView(item) {\r\n        let worldPos = item.parent.convertToWorldSpaceAR(item.position);\r\n        let viewPos = this.sv.content.parent.convertToNodeSpaceAR(worldPos);\r\n        return viewPos;\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (!this.datas || this.datas.length < 1) return;\r\n        this.updateTimer += dt;\r\n        if (this.updateTimer < this.updateInterval) return;\r\n        this.updateTimer = 0;\r\n        //判断滑动方向。\r\n        let diff = this.sv.content.y - this.lastContentPosY;\r\n        if (diff === 0) return;\r\n        let offset = (this.itemSize.height + this.spacing) * this.itemNodes.length;\r\n        this.itemNodes.forEach((item) => {\r\n            let viewPos = this.getPositionInView(item);\r\n            let script = item.getComponent(this.itemPrefab.name);\r\n            if (diff < 0) {//向下滑动\r\n                if (viewPos.y < -offset / 2 && item.y + offset < 0) {\r\n                    item.setPositionY(item.y + offset);\r\n                    item.tag = item.tag - this.itemNodes.length;\r\n                    script.updateItem(this.datas[item.tag], this.callback);\r\n                }\r\n            } else {//向上滑动\r\n                if (viewPos.y > offset / 2 && item.y - offset > -this.sv.content.height) {\r\n                    item.setPositionY(item.y - offset);\r\n                    item.tag = item.tag + this.itemNodes.length;\r\n                    script.updateItem(this.datas[item.tag], this.callback);\r\n                }\r\n            }\r\n        }, this);\r\n        // 更新上次记录的Y坐标\r\n        this.lastContentPosY = this.sv.content.y;\r\n    }\r\n}\r\n"]}